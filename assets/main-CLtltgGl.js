import{C as U,L as F,F as k,B as W,a as L,W as D,P as Y,A as O,S as X,b as Z,H as q,T as $,c as H,d as J,e as K,f as Q,g as E,M as _,h as G}from"./style-BuvN1NwK.js";import{g as ee}from"./lil-gui.module.min-Bc0DeA9g.js";import{O as te}from"./OrbitControls-DlGf4_PH.js";const f=new U;class ne extends F{constructor(d){super(d),this.propertyNameMapping={},this.customPropertyMapping={}}load(d,T,v,S){const z=this,M=new k(this.manager);M.setPath(this.path),M.setResponseType("arraybuffer"),M.setRequestHeader(this.requestHeader),M.setWithCredentials(this.withCredentials),M.load(d,function(P){try{T(z.parse(P))}catch(h){S?S(h):console.error(h),z.manager.itemError(d)}},v,S)}setPropertyNameMapping(d){this.propertyNameMapping=d}setCustomPropertyNameMapping(d){this.customPropertyMapping=d}parse(d){function T(e,s=0){const n=/^ply([\s\S]*)end_header(\r\n|\r|\n)/;let t="";const r=n.exec(e);r!==null&&(t=r[1]);const o={comments:[],elements:[],headerLength:s,objInfo:""},i=t.split(/\r\n|\r|\n/);let a;function y(p,m){const u={type:p[0]};return u.type==="list"?(u.name=p[3],u.countType=p[1],u.itemType=p[2]):u.name=p[1],u.name in m&&(u.name=m[u.name]),u}for(let p=0;p<i.length;p++){let m=i[p];if(m=m.trim(),m==="")continue;const u=m.split(/\s+/),N=u.shift();switch(m=u.join(" "),N){case"format":o.format=u[0],o.version=u[1];break;case"comment":o.comments.push(m);break;case"element":a!==void 0&&o.elements.push(a),a={},a.name=u[0],a.count=parseInt(u[1]),a.properties=[];break;case"property":a.properties.push(y(u,B.propertyNameMapping));break;case"obj_info":o.objInfo=m;break;default:console.log("unhandled",N,u)}}return a!==void 0&&o.elements.push(a),o}function v(e,s){switch(s){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function S(e,s){const n={};for(let t=0;t<e.length;t++){if(s.empty())return null;if(e[t].type==="list"){const r=[],o=v(s.next(),e[t].countType);for(let i=0;i<o;i++){if(s.empty())return null;r.push(v(s.next(),e[t].itemType))}n[e[t].name]=r}else n[e[t].name]=v(s.next(),e[t].type)}return n}function z(){const e={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]};for(const s of Object.keys(B.customPropertyMapping))e[s]=[];return e}function M(e){const s=e.map(t=>t.name);function n(t){for(let r=0,o=t.length;r<o;r++){const i=t[r];if(s.includes(i))return i}return null}return{attrX:n(["x","px","posx"])||"x",attrY:n(["y","py","posy"])||"y",attrZ:n(["z","pz","posz"])||"z",attrNX:n(["nx","normalx"]),attrNY:n(["ny","normaly"]),attrNZ:n(["nz","normalz"]),attrS:n(["s","u","texture_u","tx"]),attrT:n(["t","v","texture_v","ty"]),attrR:n(["red","diffuse_red","r","diffuse_r"]),attrG:n(["green","diffuse_green","g","diffuse_g"]),attrB:n(["blue","diffuse_blue","b","diffuse_b"])}}function P(e,s){const n=z(),t=/end_header\s+(\S[\s\S]*\S|\S)\s*$/;let r,o;(o=t.exec(e))!==null?r=o[1].split(/\s+/):r=[];const i=new re(r);e:for(let a=0;a<s.elements.length;a++){const y=s.elements[a],p=M(y.properties);for(let m=0;m<y.count;m++){const u=S(y.properties,i);if(!u)break e;w(n,y.name,u,p)}}return h(n)}function h(e){let s=new W;e.indices.length>0&&s.setIndex(e.indices),s.setAttribute("position",new L(e.vertices,3)),e.normals.length>0&&s.setAttribute("normal",new L(e.normals,3)),e.uvs.length>0&&s.setAttribute("uv",new L(e.uvs,2)),e.colors.length>0&&s.setAttribute("color",new L(e.colors,3)),(e.faceVertexUvs.length>0||e.faceVertexColors.length>0)&&(s=s.toNonIndexed(),e.faceVertexUvs.length>0&&s.setAttribute("uv",new L(e.faceVertexUvs,2)),e.faceVertexColors.length>0&&s.setAttribute("color",new L(e.faceVertexColors,3)));for(const n of Object.keys(B.customPropertyMapping))e[n].length>0&&s.setAttribute(n,new L(e[n],B.customPropertyMapping[n].length));return s.computeBoundingSphere(),s}function w(e,s,n,t){if(s==="vertex"){e.vertices.push(n[t.attrX],n[t.attrY],n[t.attrZ]),t.attrNX!==null&&t.attrNY!==null&&t.attrNZ!==null&&e.normals.push(n[t.attrNX],n[t.attrNY],n[t.attrNZ]),t.attrS!==null&&t.attrT!==null&&e.uvs.push(n[t.attrS],n[t.attrT]),t.attrR!==null&&t.attrG!==null&&t.attrB!==null&&(f.setRGB(n[t.attrR]/255,n[t.attrG]/255,n[t.attrB]/255).convertSRGBToLinear(),e.colors.push(f.r,f.g,f.b));for(const r of Object.keys(B.customPropertyMapping))for(const o of B.customPropertyMapping[r])e[r].push(n[o])}else if(s==="face"){const r=n.vertex_indices||n.vertex_index,o=n.texcoord;r.length===3?(e.indices.push(r[0],r[1],r[2]),o&&o.length===6&&(e.faceVertexUvs.push(o[0],o[1]),e.faceVertexUvs.push(o[2],o[3]),e.faceVertexUvs.push(o[4],o[5]))):r.length===4&&(e.indices.push(r[0],r[1],r[3]),e.indices.push(r[1],r[2],r[3])),t.attrR!==null&&t.attrG!==null&&t.attrB!==null&&(f.setRGB(n[t.attrR]/255,n[t.attrG]/255,n[t.attrB]/255).convertSRGBToLinear(),e.faceVertexColors.push(f.r,f.g,f.b),e.faceVertexColors.push(f.r,f.g,f.b),e.faceVertexColors.push(f.r,f.g,f.b))}}function l(e,s){const n={};let t=0;for(let r=0;r<s.length;r++){const o=s[r],i=o.valueReader;if(o.type==="list"){const a=[],y=o.countReader.read(e+t);t+=o.countReader.size;for(let p=0;p<y;p++)a.push(i.read(e+t)),t+=i.size;n[o.name]=a}else n[o.name]=i.read(e+t),t+=i.size}return[n,t]}function b(e,s,n){function t(r,o,i){switch(o){case"int8":case"char":return{read:a=>r.getInt8(a),size:1};case"uint8":case"uchar":return{read:a=>r.getUint8(a),size:1};case"int16":case"short":return{read:a=>r.getInt16(a,i),size:2};case"uint16":case"ushort":return{read:a=>r.getUint16(a,i),size:2};case"int32":case"int":return{read:a=>r.getInt32(a,i),size:4};case"uint32":case"uint":return{read:a=>r.getUint32(a,i),size:4};case"float32":case"float":return{read:a=>r.getFloat32(a,i),size:4};case"float64":case"double":return{read:a=>r.getFloat64(a,i),size:8}}}for(let r=0,o=e.length;r<o;r++){const i=e[r];i.type==="list"?(i.countReader=t(s,i.countType,n),i.valueReader=t(s,i.itemType,n)):i.valueReader=t(s,i.type,n)}}function x(e,s){const n=z(),t=s.format==="binary_little_endian",r=new DataView(e,s.headerLength);let o,i=0;for(let a=0;a<s.elements.length;a++){const y=s.elements[a],p=y.properties,m=M(p);b(p,r,t);for(let u=0;u<y.count;u++){o=l(i,p),i+=o[1];const N=o[0];w(n,y.name,N,m)}}return h(n)}function V(e){let s=0,n=!0,t="";const r=[],o=new TextDecoder().decode(e.subarray(0,5)),i=/^ply\r\n/.test(o);do{const a=String.fromCharCode(e[s++]);a!==`
`&&a!=="\r"?t+=a:(t==="end_header"&&(n=!1),t!==""&&(r.push(t),t=""))}while(n&&s<e.length);return i===!0&&s++,{headerText:r.join("\r")+"\r",headerLength:s}}let A;const B=this;if(d instanceof ArrayBuffer){const e=new Uint8Array(d),{headerText:s,headerLength:n}=V(e),t=T(s,n);if(t.format==="ascii"){const r=new TextDecoder().decode(e);A=P(r,t)}else A=x(d,t)}else A=P(d,T(d));return A}}class re{constructor(d){this.arr=d,this.i=0}empty(){return this.i>=this.arr.length}next(){return this.arr[this.i++]}}let g,R,I,c,j;se();function se(){g=new D({antialias:!0}),g.setPixelRatio(window.devicePixelRatio),g.setSize(window.innerWidth,window.innerHeight),document.getElementById("container").appendChild(g.domElement),g.shadowMap.enabled=!0,g.shadowMap.type=Y,g.toneMapping=O,g.toneMappingExposure=1,g.setAnimationLoop(ae),R=new X,I=new Z(40,window.innerWidth/window.innerHeight,.1,100),I.position.set(7,4,1);const C=new te(I,g.domElement);C.minDistance=2,C.maxDistance=10,C.maxPolarAngle=Math.PI/2,C.target.set(0,1,0),C.update();const d=new q(16777215,9276813,.15);R.add(d);const T=new $().setPath("sculpture/"),v=["disturb.jpg"],S={none:null};for(let l=0;l<v.length;l++){const b=v[l],x=T.load(b);x.minFilter=H,x.magFilter=H,x.colorSpace=J,S[b]=x}c=new K(16777215,100),c.position.set(2.5,5,2.5),c.angle=Math.PI/6,c.penumbra=1,c.decay=2,c.distance=0,c.map=S["disturb.jpg"],c.castShadow=!0,c.shadow.mapSize.width=1024,c.shadow.mapSize.height=1024,c.shadow.camera.near=1,c.shadow.camera.far=10,c.shadow.focus=1,R.add(c),j=new Q(c),R.add(j);const z=new E(200,200),M=new _({color:12369084}),P=new G(z,M);P.position.set(0,-1,0),P.rotation.x=-Math.PI/2,P.receiveShadow=!0,R.add(P),new ne().load("sculpture/Lucy100k.ply",function(l){l.scale(.0024,.0024,.0024),l.computeVertexNormals();const b=new _,x=new G(l,b);x.rotation.y=-Math.PI/2,x.position.y=.8,x.castShadow=!0,x.receiveShadow=!0,R.add(x)}),window.addEventListener("resize",oe);const h=new ee,w={map:S["disturb.jpg"],color:c.color.getHex(),intensity:c.intensity,distance:c.distance,angle:c.angle,penumbra:c.penumbra,decay:c.decay,focus:c.shadow.focus,shadows:!0};h.add(w,"map",S).onChange(function(l){c.map=l}),h.addColor(w,"color").onChange(function(l){c.color.setHex(l)}),h.add(w,"intensity",0,500).onChange(function(l){c.intensity=l}),h.add(w,"distance",50,200).onChange(function(l){c.distance=l}),h.add(w,"angle",0,Math.PI/3).onChange(function(l){c.angle=l}),h.add(w,"penumbra",0,1).onChange(function(l){c.penumbra=l}),h.add(w,"decay",1,2).onChange(function(l){c.decay=l}),h.add(w,"focus",0,1).onChange(function(l){c.shadow.focus=l}),h.add(w,"shadows").onChange(function(l){g.shadowMap.enabled=l,R.traverse(function(b){b.material&&(b.material.needsUpdate=!0)})}),h.open()}function oe(){I.aspect=window.innerWidth/window.innerHeight,I.updateProjectionMatrix(),g.setSize(window.innerWidth,window.innerHeight)}function ae(){const C=performance.now()/3e3;c.position.x=Math.cos(C)*2.5,c.position.z=Math.sin(C)*2.5,j.update(),g.render(R,I)}
